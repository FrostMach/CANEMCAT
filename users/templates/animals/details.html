{% extends 'base.html' %}

{% block content %}
<div class="container mt-5 p-4 bg-white shadow-sm rounded">
    <h1>{{ animal.name }}</h1>
    
    <p><strong>Edad:</strong> {{ animal.age }} años</p>
    <p><strong>Especie:</strong> {{ animal.get_species_display }}</p>
    <p><strong>Descripción: </strong> {{ animal.description }}</p>
    <p><strong>Imagen: </strong><img src="{{ animal.image.url }}" class="card-img-top small-img" alt="{{ animal.name }}"></p>
    <p><strong>Estado de adopción: </strong> {{ animal.adoption_status }}</p>
    {% if user.is_authenticated %}
        {% if not is_in_wishlist %}
            <form action="{% url 'wishlist_add' animal.id %}" method="post">
                {% csrf_token %}
                <button type="submit" onclick="recordInteraction({{ animal.id }}, 'favorite')" class="btn btn-success">Añadir a Favoritos</button>
            </form>
        {% endif %}
    {% else %}
        <p>Debes iniciar sesión para agregar este animal a favoritos.</p>
    {% endif %}
    <a href="{% url 'animals-list' %}" class="btn btn-secondary">Volver al listado</a>
</div>

<script>
    function recordInteraction(animal_id, interaction_type){
        fetch(`/animals/${animal_id}/interact/${interaction_type}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken':'{{ csrf_token }}',
            }
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message || 'Interacción registrada')
        })
        .catch(error => {
            console.error('Error registrando la interacción: ', error)
        });
    }
</script>
{% endblock %}